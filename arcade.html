<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>FIGHTSHIFT â€” Arcade (D/P style)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="style.css" />
<link rel="icon" type="image/png" href="favicon.png" />
<style>
  .arena-dp{max-width:980px;margin:0 auto;border:2px solid var(--ring);border-radius:16px;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.2));box-shadow:0 0 12px var(--ring2);overflow:hidden}
  .battle-top{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:16px 16px 0 16px;min-height:220px}
  .field{background:radial-gradient(ellipse at center,rgba(255,255,255,.05),rgba(0,0,0,.1));border:1px solid rgba(255,255,255,.06);border-radius:12px;position:relative;display:flex;align-items:end;justify-content:center;overflow:hidden}
  .back-plate{position:absolute;inset:auto 10% 10% 10%;height:36%;border-radius:999px;background:radial-gradient(ellipse at center,rgba(255,255,255,.06),rgba(0,0,0,.2))}
  .sprite{position:relative;z-index:2;font-size:14px;color:#fff;text-shadow:0 2px 0 #000; margin-bottom:6px}
  .shake{animation:shake .2s linear 2}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
  .hud{position:absolute;left:8px;right:8px;top:8px;display:flex;justify-content:space-between;gap:8px;pointer-events:none}
  .hud .box{pointer-events:auto;min-width:46%;padding:8px;border-radius:10px;background:rgba(0,0,0,.45);border:2px solid var(--ring)}
  .hud .name{display:flex;align-items:center;justify-content:space-between;font-size:12px;color:#fff}
  .hpbar{height:10px;background:#111;border-radius:8px;overflow:hidden;border:1px solid #0ff;margin-top:6px}
  .hpfill{height:100%;width:100%}
  .hp-red{background:linear-gradient(90deg,#ff416c,#ff4b2b)}
  .hp-blue{background:linear-gradient(90deg,#00c6ff,#0072ff)}
  .hp-green{background:linear-gradient(90deg,#00ff7a,#00c853)}
  .battle-bottom{background:rgba(0,0,0,.55);border-top:2px solid var(--ring);padding:10px;display:grid;grid-template-columns:2fr 3fr;gap:10px}
  .textbox{min-height:100px;background:rgba(0,0,0,.35);border:2px solid var(--ring);border-radius:10px;padding:10px;text-align:left;overflow:auto}
  .cmd{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .mv{border:2px solid var(--ring);border-radius:12px;background:#000;color:#fff;padding:10px;text-align:left;cursor:pointer;display:flex;flex-direction:column;gap:4px}
  .mv[data-disabled="1"]{opacity:.45;pointer-events:none}
  .mv .head{display:flex;justify-content:space-between;align-items:center;font-size:12px}
  .mv .pp{font-size:11px;opacity:.9}
  .mv .type{font-size:11px}
  .t-red{border-color:#ff4b2b} .t-blue{border-color:#0072ff} .t-green{border-color:#00c853}
  .mini{font-size:11px;opacity:.85}
</style>
</head>
<body>
  <div class="page">
    <header class="header">
      <div class="brand">FIGHTSHIFT</div>
      <nav class="nav">
        <button class="btn btn-ghost" onclick="location.href='index.html'">Menu</button>
        <button class="btn btn-ghost" onclick="location.href='roster_static.html'">Roster</button>
        <button class="btn btn-ghost" onclick="location.href='rules.html'">RÃ¨gles</button>
      </nav>
    </header>

    <main class="container">
      <h1>Mode Arcade â€” Combat</h1>

      <div class="arena-dp">
        <div class="battle-top">
          <div class="field" id="fieldE">
            <div class="hud">
              <div class="box">
                <div class="name"><span id="eName">â€”</span><span class="lv" id="eLv">ACT 1-1</span></div>
                <div class="hpbar"><div class="hpfill" id="eHP"></div></div>
                <div class="mini" id="eMeta"></div>
              </div>
            </div>
            <div class="back-plate"></div>
            <div class="sprite" id="eSprite">[ Ennemi ]</div>
          </div>

          <div class="field" id="fieldP">
            <div class="hud">
              <div class="box">
                <div class="name"><span id="pName">â€”</span><span class="lv" id="pLv">ACT 1-1</span></div>
                <div class="hpbar"><div class="hpfill" id="pHP"></div></div>
                <div class="mini" id="pMeta"></div>
              </div>
            </div>
            <div class="back-plate"></div>
            <div class="sprite" id="pSprite">[ Joueur ]</div>
          </div>
        </div>

        <div class="battle-bottom" style="display:grid;grid-template-columns:2fr 3fr;gap:10px;background:rgba(0,0,0,.55);border-top:2px solid var(--ring);padding:10px">
          <div class="textbox" id="log" style="min-height:100px;background:rgba(0,0,0,.35);border:2px solid var(--ring);border-radius:10px;padding:10px;text-align:left;overflow:auto"></div>

          <div>
            <div class="mini" style="margin-bottom:8px">
              <label>Acte <select id="actSel"><option>1</option><option>2</option><option>3</option><option>4</option></select></label>
              <label>Stage <select id="stageSel"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select></label>
              <label>Perso <select id="playerSel"></select></label>
              <button class="btn" id="startBtn">ðŸŽ® Lancer</button>
              <button class="btn btn-ghost" id="resetBtn">â†º Reset</button>
            </div>

            <div class="cmd">
              <button class="mv" id="mv1"><div class="head"><span class="label">â€”</span><span class="pp">PP â€”</span></div><div class="type">â€”</div></button>
              <button class="mv" id="mv2"><div class="head"><span class="label">â€”</span><span class="pp">PP â€”</span></div><div class="type">â€”</div></button>
              <button class="mv" id="mv3"><div class="head"><span class="label">â€”</span><span class="pp">PP â€”</span></div><div class="type">â€”</div></button>
              <button class="mv" id="mv4"><div class="head"><span class="label">â€”</span><span class="pp">PP â€”</span></div><div class="type">â€”</div></button>
            </div>
            <div class="mini" style="margin-top:6px">PrÃ©cision/crit/avantages actifs. Prio +1 agit avant.</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <audio id="bg-music" loop><source src="techno_syndrome.mp3" type="audio/mpeg" /></audio>
  <script src="shared-audio.js"></script>

<script>
window.sharedAudio.tryResume(document.getElementById('bg-music'));
const ADV = { red:'green', green:'blue', blue:'red' };
const COLORNAME = c => c==='red'?'ROUGE':(c==='blue'?'BLEU':'VERT');
const HPCLASS = c => c==='red'?'hp-red':(c==='blue'?'hp-blue':'hp-green');
const DEFAULT_MOVE = { power:70, acc:95, type:"color", prio:0, kind:"phys", pp:15, cd:0, text:"Attaque personnalisÃ©e (valeurs par dÃ©faut)." };
const MOVES = {
  "Quick Slash":{power:55,acc:100,type:"neutral",prio:1,kind:"phys",pp:25,cd:0,text:"Coup rapide."},
  "Heavy Blow":{power:95,acc:80,type:"neutral",prio:0,kind:"phys",pp:10,cd:1,text:"Puissant mais imprÃ©cis."},
  "Color Blast":{power:70,acc:95,type:"color",prio:0,kind:"spec",pp:15,cd:0,text:"Attaque de couleur."},
  "Guard":{power:0,acc:0,type:"neutral",prio:2,kind:"status",pp:20,cd:1,text:"Bouclier (-30% ce tour)."},
  "Power Up":{power:0,acc:0,type:"neutral",prio:0,kind:"status",pp:10,cd:2,text:"+30% ATK (3t)"},
  "Heal":{power:0,acc:0,type:"neutral",prio:0,kind:"status",pp:6,cd:2,text:"Soin 30% PV"},
  "Bleed":{power:40,acc:90,type:"neutral",prio:0,kind:"phys",pp:15,cd:1,text:"Saignement 5t (6%).",apply:"bleed",proc:100},
  "Burn":{power:60,acc:85,type:"red",prio:0,kind:"spec",pp:10,cd:1,text:"BrÃ»lure possible.",apply:"burn",proc:80},
  "Backstab":{power:75,acc:95,type:"blue",prio:0,kind:"phys",pp:10,cd:1,text:"Crit x2 si avantage.",critBonus:true},
  "Invisibility":{power:0,acc:0,type:"blue",prio:2,kind:"status",pp:6,cd:3,text:"Esquive +40% (2t).",apply:"invis"},
  "Charging Slash":{power:80,acc:90,type:"red",prio:0,kind:"phys",pp:10,cd:1,text:"Charge tranchante."},
  "Devil Trigger":{power:0,acc:0,type:"red",prio:0,kind:"status",pp:3,cd:4,text:"+40% ATK +20% SPD (3t).",apply:"devil"},
  "Gravity Shift":{power:0,acc:0,type:"green",prio:1,kind:"status",pp:8,cd:2,text:"-20% ATK ennemi, +20% DEF (3t).",apply:"grav"},
  "Mind Pierce":{power:85,acc:90,type:"green",prio:0,kind:"spec",pp:10,cd:1,text:"Perce lâ€™esprit."},
  "Slow Time":{power:0,acc:0,type:"green",prio:1,kind:"status",pp:8,cd:2,text:"-20% SPD (3t).",apply:"slow",proc:100},
  "Shadow Strike":{power:70,acc:95,type:"blue",prio:0,kind:"phys",pp:15,cd:0,text:"Attaque de lâ€™ombre."},
  "Focus":{power:0,acc:0,type:"neutral",prio:1,kind:"status",pp:8,cd:2,text:"+10% acc +10% crit (3t)."}
};
function ensureMove(n){ if(!n) return null; if(!MOVES[n]) MOVES[n] = {...DEFAULT_MOVE}; return MOVES[n]; }
const el=id=>document.getElementById(id), log=el('log');
const actSel=el('actSel'), stageSel=el('stageSel'), playerSel=el('playerSel');
const startBtn=el('startBtn'), resetBtn=el('resetBtn');
const eName=el('eName'), eLv=el('eLv'), eHP=el('eHP'), eMeta=el('eMeta'), eSprite=el('eSprite');
const pName=el('pName'), pLv=el('pLv'), pHP=el('pHP'), pMeta=el('pMeta'), pSprite=el('pSprite');
const mButtons=[el('mv1'),el('mv2'),el('mv3'),el('mv4')];
let ROSTER=[], P=null,E=null, act=1,stage=1; const SAVEKEY='FIGHTSHIFT_ARCADE_V3';
function rnd(a,b){return Math.random()*(b-a)+a} function chance(p){return Math.random()*100<p}
function clamp(v,a,b){return Math.max(a,Math.min(b,v))}
function typeMult(attType, attColor, defColor){ const t=(attType==='color')?attColor:(['red','blue','green'].includes(attType)?attType:null); if(!t) return 1.0; return ( {red:'green',green:'blue',blue:'red'}[t]===defColor )?1.5:1.0; }
function accRoll(base, A, D){ if(base<=0) return true; let acc=base; acc+=A.accBase*0.5; acc-=D.evaBase*0.5; if(A.buffs?.focus>0) acc+=10; if(D.states?.invis>0) acc-=40; return chance(clamp(acc,1,100)); }
function critRoll(A, m, adv){ let c=A.critBase; if(A.buffs?.focus>0) c+=10; if(m.critBonus && adv>1) c+=20; return chance(clamp(c,0,100))?(m.kind==='phys'?1.8:1.6):1.0; }
function makeFighter(b){ const d=(v,x)=>(v==null?x:v), r=b.resists||{}; return {
  id:b.id,name:b.name,color:b.color,short:b.short||'',hpMax:d(b.hp_max,600),hp:d(b.hp_max,600),
  speedBase:d(b.speed,240),speedMod:1,atkBase:d(b.atk,70),spatkBase:d(b.spatk,70),
  defBase:d(b.def,70),spdefBase:d(b.spdef,70),accBase:d(b.acc,0),evaBase:d(b.eva,0),critBase:d(b.crit,6),
  resists:{bleed:d(r.bleed,0),burn:d(r.burn,0),slow:d(r.slow,0)},
  atkMod:1,defMod:1,spAtkMod:1,spDefMod:1,accMod:1,evaMod:1,
  buffs:{power:0,focus:0,devil:0,grav:0}, states:{bleed:0,burn:0,invis:0,slow:0},
  moves:(b.moves||[]).slice(0,4).map(n=>{ensureMove(n);return {name:n,pp:(MOVES[n]?.pp??15),cd:0};})
};}
function applyStartOfTurn(f){ for(const k in f.buffs){if(f.buffs[k]>0)f.buffs[k]--} for(const k in f.states){if(f.states[k]>0)f.states[k]--}
  f.atkMod=f.defMod=f.spAtkMod=f.spDefMod=f.speedMod=f.accMod=f.evaMod=1;
  if(f.buffs.power>0){f.atkMod*=1.3;f.spAtkMod*=1.3} if(f.buffs.devil>0){f.atkMod*=1.4;f.spAtkMod*=1.4;f.speedMod*=1.2}
  if(f.buffs.grav>0){f.defMod*=1.2;f.spDefMod*=1.2} if(f.states.burn>0){f.atkMod*=0.8} if(f.states.slow>0){f.speedMod*=0.8}
  if(f.buffs.focus>0){f.accMod*=1.1;f.critBonus=10}else f.critBonus=0;
  if(f.states.bleed>0){ const dot=Math.max(1,Math.floor(f.hpMax*0.06)); f.hp=clamp(f.hp-dot,0,f.hpMax); pushLog(`${f.name} saigne (${dot}).`); }
}
function beginCooldowns(f){ f.moves.forEach(m=>{if(m.cd>0)m.cd--}) } function moveReady(m){return m.pp>0&&m.cd===0}
function setHPBars(){ pHP.className='hpfill '+HPCLASS(P.color); eHP.className='hpfill '+HPCLASS(E.color); pHP.style.width=Math.round(100*P.hp/P.hpMax)+'%'; eHP.style.width=Math.round(100*E.hp/E.hpMax)+'%'; }
function setNames(){ pName.textContent=`${P.name} [${COLORNAME(P.color)}]`; eName.textContent=`${E.name} [${COLORNAME(E.color)}]`; pLv.textContent=`ACT ${act}-${stage}`; eLv.textContent=`ACT ${act}-${stage}`; pSprite.textContent='[ '+P.name+' ]'; eSprite.textContent='[ '+E.name+' ]'; updateMeta(); }
function statusBadges(f){ const a=[]; if(f.states.bleed>0)a.push(`<span>BLD ${f.states.bleed}</span>`); if(f.states.burn>0)a.push(`<span>BRN ${f.states.burn}</span>`); if(f.states.invis>0)a.push(`<span>INV ${f.states.invis}</span>`); if(f.buffs.devil>0)a.push(`<span>DEV ${f.buffs.devil}</span>`); if(f.buffs.power>0)a.push(`<span>POW ${f.buffs.power}</span>`); if(f.buffs.grav>0)a.push(`<span>GRV ${f.buffs.grav}</span>`); if(f.buffs.focus>0)a.push(`<span>FOC ${f.buffs.focus}</span>`); if(f.states.slow>0)a.push(`<span>SLW ${f.states.slow}</span>`); return a.join(' ') }
function updateMeta(){ pMeta.innerHTML=statusBadges(P); eMeta.innerHTML=statusBadges(E); }
function pushLog(t){ log.innerHTML+=`<p>${t}</p>`; log.scrollTop=log.scrollHeight; }
async function loadRoster(){ try{ const r=await fetch('roster.json',{cache:'no-store'}); if(!r.ok) throw 0; ROSTER=await r.json(); }catch(e){ ROSTER=[]; } if(!ROSTER.length) alert('roster.json introuvable'); playerSel.innerHTML=ROSTER.map((c,i)=>`<option value="${i}">${c.name}</option>`).join(''); }
function genEnemy(){ const b=ROSTER[Math.floor(Math.random()*ROSTER.length)]; const bonus=Math.floor((act-1)*40+(stage-1)*10); const c=JSON.parse(JSON.stringify(b)); c.hp_max+=bonus; c.speed=(c.speed||240)+Math.floor((act-1)*5); return c; }
function setupBattle(){ const pBase=ROSTER[playerSel.value]; P=makeFighter(pBase); E=makeFighter(genEnemy()); setNames(); setHPBars(); renderMoves(); log.innerHTML=`<p>Un ${E.name} apparaÃ®t !</p>`; }
function renderMoves(){ const list=P.moves; const btns=[document.getElementById('mv1'),document.getElementById('mv2'),document.getElementById('mv3'),document.getElementById('mv4')]; for(let i=0;i<4;i++){ const b=btns[i], m=list[i]; if(!m){ b.dataset.disabled='1'; b.querySelector('.label').textContent='â€”'; b.querySelector('.pp').textContent='PP â€”'; b.querySelector('.type').textContent='â€”'; b.classList.remove('t-red','t-blue','t-green'); continue; } const def=ensureMove(m.name); b.dataset.disabled = moveReady(m)?'0':'1'; b.querySelector('.label').textContent=m.name; b.querySelector('.pp').textContent=`PP ${m.pp}${def.cd?` â€¢ CD ${m.cd}`:''}`; const typ=def.type==='color'?P.color:(['red','blue','green'].includes(def.type)?def.type:'neutral'); b.querySelector('.type').textContent=def.text; b.classList.remove('t-red','t-blue','t-green'); if(typ==='red')b.classList.add('t-red'); else if(typ==='blue')b.classList.add('t-blue'); else if(typ==='green')b.classList.add('t-green'); b.onclick=()=>chooseMove(i); } }
function startTurn(){ beginCooldowns(P); beginCooldowns(E); applyStartOfTurn(P); applyStartOfTurn(E); updateMeta(); setHPBars(); }
function endCheck(){ if(E.hp<=0){ pushLog(`<strong>${E.name} est K.O. â€” Victoire !</strong>`); stageAdvance(); return true } if(P.hp<=0){ pushLog(`<strong>${P.name} est K.O. â€” DÃ©faiteâ€¦</strong>`); return true } return false }
function stageAdvance(){ if(stage<10) stageSel.value=String(++stage); else { stageSel.value='1'; if(act<4) actSel.value=String(++act); } act=parseInt(actSel.value,10); stage=parseInt(stageSel.value,10); saveProgress(); }
function damageCalc(att,def,mv){ const m=ensureMove(mv.name); const base=m.power; const stab=(m.type==='color'||m.type===att.color)?1.2:1.0; const adv=typeMult(m.type,(m.type==='color'?att.color:m.type),def.color); const crit=critRoll(att,m,adv); const atkStat=(m.kind==='phys')?att.atkBase*att.atkMod:att.spatkBase*att.spAtkMod; const defStat=(m.kind==='phys')?def.defBase*def.defMod:def.spdefBase*def.spDefMod; const rand=0.85+Math.random()*0.15; const scalar=atkStat/Math.max(10,defStat); const dmg=Math.floor(base*stab*adv*crit*scalar*rand); return {dmg:Math.max(1,dmg),adv,crit}; }
function applyMove(att,def,mv){ const m=ensureMove(mv.name); if(m.acc>0 && !accRoll(m.acc,att,def)){ pushLog(`${att.name} rate ${mv.name} !`); return } if(m.kind==='status'){ const proc=(m.proc??100); const resist=(n)=>clamp((def.resists?.[n]??0),0,100); const passes=(n)=>chance(clamp(proc-resist(n),0,100)); switch(m.apply){ case 'burn': if(passes('burn')){ def.states.burn=Math.max(def.states.burn,3); pushLog(`${def.name} est brÃ»lÃ© !`) } else pushLog(`${def.name} rÃ©siste Ã  la brÃ»lure.`); break; case 'bleed': if(passes('bleed')){ def.states.bleed=Math.max(def.states.bleed,5); pushLog(`${def.name} saigne !`) } else pushLog(`${def.name} rÃ©siste au saignement.`); break; case 'slow': if(passes('slow')){ def.states.slow=Math.max(def.states.slow,3); pushLog(`${def.name} est ralenti !`) } else pushLog(`${def.name} rÃ©siste au ralentissement.`); break; case 'invis': att.states.invis=Math.max(att.states.invis,2); pushLog(`${att.name} devient quasi invisible !`); break; case 'devil': att.buffs.devil=Math.max(att.buffs.devil,3); pushLog(`${att.name} active Devil Trigger !`); break; case 'grav': def.buffs.grav=Math.max(def.buffs.grav,3); pushLog(`${def.name} est sous gravitÃ© accrue !`); break; default: if(mv.name==='Guard'){ att.guardThisTurn=true; pushLog(`${att.name} se protÃ¨ge !`) } if(mv.name==='Power Up'){ att.buffs.power=Math.max(att.buffs.power,3); pushLog(`${att.name} se renforce !`) } if(mv.name==='Heal'){ const h=Math.floor(att.hpMax*0.3); att.hp=Math.min(att.hpMax,att.hp+h); pushLog(`${att.name} rÃ©cupÃ¨re ${h} PV`) } } } else { const r=damageCalc(att,def,mv); let real=r.dmg; if(def.guardThisTurn) real=Math.floor(real*0.7); def.hp=clamp(def.hp-real,0,def.hpMax); pushLog(`${att.name} utilise ${mv.name} â€” ${real} dÃ©gÃ¢ts${r.adv>1?' (AVANTAGE)':''}${r.crit>1?' (CRITIQUE)':''}.`); setHPBars(); } }
function chooseMove(i){ const mv=P.moves[i]; if(!mv||!moveReady(mv)) return; doTurn(mv); }
function doTurn(pMove){ const eIdx=chooseEnemyMove(), eMove=E.moves[eIdx]; const pm=ensureMove(pMove.name), em=ensureMove(eMove.name); const pSpeed=P.speedBase*P.speedMod+(pm.prio||0)*100; const eSpeed=E.speedBase*E.speedMod+(em.prio||0)*100; beginCooldowns(P); beginCooldowns(E); applyStartOfTurn(P); applyStartOfTurn(E); P.guardThisTurn=false; E.guardThisTurn=false; const first=(pSpeed===eSpeed)?(Math.random()<0.5?'P':'E'):(pSpeed>eSpeed?'P':'E'); const order=first==='P'?[['P',pMove],['E',eMove]]:[['E',eMove],['P',pMove]]; for(const [who,mv] of order){ if(endCheck()) break; const owner=(who==='P')?P:E; const inv=owner.moves.find(x=>x.name===mv.name); if(inv){ inv.pp=Math.max(0,inv.pp-1); inv.cd=Math.max(inv.cd,ensureMove(mv.name).cd||0); } if(who==='P') applyMove(P,E,mv); else applyMove(E,P,mv); if(endCheck()) break; } renderMoves(); }
function chooseEnemyMove(){ const R=E.moves.map((m,i)=>({m,i,def:ensureMove(m.name)})).filter(x=>moveReady(x.m)); if(!R.length) return 0; for(const x of R){ if((x.def.power||0)>0){ const sim=damageCalc(E,P,x.m).dmg; if(sim>=P.hp) return x.i; } } const adv=R.filter(x=>{ const t=x.def.type==='color'?E.color:(['red','blue','green'].includes(x.def.type)?x.def.type:null); return t && ADV[t]===P.color; }); if(adv.length) return adv[Math.floor(Math.random()*adv.length)].i; const sts=R.filter(x=>x.def.kind==='status'); if(sts.length && Math.random()<0.5) return sts[Math.floor(Math.random()*sts.length)].i; R.sort((a,b)=>(b.def.power||0)-(a.def.power||0)); return R[0].i; }
function saveProgress(){ localStorage.setItem(SAVEKEY, JSON.stringify({act,stage,playerId:ROSTER[playerSel.value]?.id})); }
function loadProgress(){ const s=JSON.parse(localStorage.getItem(SAVEKEY)||'{}'); if(s.act) actSel.value=String(s.act); if(s.stage) stageSel.value=String(s.stage); if(s.playerId){ const idx=ROSTER.findIndex(x=>x.id===s.playerId); if(idx>=0) playerSel.value=String(idx);} act=parseInt(actSel.value,10)||1; stage=parseInt(stageSel.value,10)||1; }
startBtn.onclick=()=>{ act=parseInt(actSel.value,10)||1; stage=parseInt(stageSel.value,10)||1; setupBattle(); saveProgress(); };
resetBtn.onclick=()=>{ localStorage.removeItem(SAVEKEY); actSel.value='1'; stageSel.value='1'; playerSel.value='0'; act=1; stage=1; log.innerHTML='Progression rÃ©initialisÃ©e.'; };
playerSel.onchange=()=>saveProgress(); actSel.onchange=()=>{ act=parseInt(actSel.value,10)||1; saveProgress(); }; stageSel.onchange=()=>{ stage=parseInt(stageSel.value,10)||1; saveProgress(); };
(async function init(){ await loadRoster(); loadProgress(); const pBase=ROSTER[playerSel.value]||ROSTER[0]; const eBase=genEnemy(); P=makeFighter(pBase); E=makeFighter(eBase); setNames(); setHPBars(); renderMoves(); pushLog("Choisis tes paramÃ¨tres puis clique Lancer."); })();
</script>
</body>
</html>
